<!DOCTYPE html>
<html>
<head>
  <title>SKU Mapper</title>
  <style>
    body { font-family: Arial; margin:20px; }
    .container { display:flex; gap:30px; }
    .col { width:45%; }
    .item { padding:6px; border-bottom:1px solid #ddd; cursor:pointer; }
    .item:hover { background:#f2f2f2; }
  </style>
</head>
<body>

<h2>Upload CSV File</h2>
<input type="file" id="fileInput"><br><br>

<div class="container">
  <div class="col">
    <h3>Uploaded Items</h3>
    <div id="left"></div>
  </div>
  <div class="col">
    <h3>Suggestions</h3>
    <div id="right"></div>
  </div>
</div>

<script>

const BACKEND = "https://sku-mapper-backend.onrender.com/match";

let items = [];

document.getElementById("fileInput").addEventListener("change", function(e){
    const reader = new FileReader();
    reader.onload = function(){
        items = reader.result.split("\n").filter(x => x.trim() !== "");
        renderLeft();
    };
    reader.readAsText(e.target.files[0]);
});

function renderLeft(){
    const leftDiv = document.getElementById("left");
    leftDiv.innerHTML = "";

    items.forEach(item=>{
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = item;

        div.addEventListener("click", function(){
            fetchMatch(item);
        });

        leftDiv.appendChild(div);
    });
}

async function fetchMatch(item){
    const response = await fetch(BACKEND + "?item=" + encodeURIComponent(item), {
        method:"POST"
    });

    const data = await response.json();

    const rightDiv = document.getElementById("right");
    rightDiv.innerHTML = "";

    data.matches.forEach(m=>{
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = m.name + " (" + m.score + ")";
        rightDiv.appendChild(div);
    });
}

</script>

</body>
</html>
